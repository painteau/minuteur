<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Minuteur</title>
<style>
  :root {
    --bg: #0f172a;
    --fg: #e5e7eb;
    --accent: #3b82f6;
    --accent-hover: #2563eb;
    --muted: #94a3b8;
  }

  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    background: var(--bg);
    color: var(--fg);
    font-family: system-ui, sans-serif;
    display: grid;
    place-items: center;
  }

  .centered {
    text-align: center;
  }

  .buttons, .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    justify-content: center;
    align-items: center;
  }

  .buttons {
    flex-direction: column;
    height: 100vh;
    justify-content: center;
  }

  .buttons.hidden {
    display: none;
  }

  .controls {
    margin-top: 1rem;
  }

  button {
    background: var(--accent);
    color: white;
    border: none;
    padding: 1rem 2rem;
    font-size: 1.2rem;
    border-radius: .75rem;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  button:hover {
    background: var(--accent-hover);
  }

  button.secondary {
    background: #334155;
  }

  button.secondary:hover {
    background: #1e293b;
  }

  #timer {
    font-size: clamp(3rem, 12vw, 12rem);
    font-variant-numeric: tabular-nums;
  }

  #status {
    color: var(--muted);
    margin-top: 1rem;
  }

  .flash {
    animation: flash 800ms ease-in-out 4;
  }

  @keyframes flash {
    0%, 100% { color: var(--fg); }
    50% { color: #22c55e; }
  }
</style>
</head>
<body>

<div class="buttons centered" id="buttonGroup">
  <button data-minutes="30">30 min</button>
  <button data-minutes="45">45 min</button>
  <button data-minutes="60">1 h</button>
  <button data-minutes="90">1 h 30</button>
  <button data-minutes="120">2 h</button>
  <button data-minutes="180">3 h</button>
</div>

<div class="centered" id="timerContainer" style="display: none;">
  <div id="timer">00:00</div>
  <div id="status">En attente…</div>
  <div class="controls">
    <button class="secondary" id="pauseBtn" disabled>Pause</button>
    <button class="secondary" id="resetBtn" disabled>Réinitialiser</button>
    <button class="secondary" id="fsBtn">Plein écran</button>
  </div>
</div>

<script>
(() => {
  const timerEl = document.getElementById('timer');
  const statusEl = document.getElementById('status');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const fsBtn = document.getElementById('fsBtn');
  const buttonsContainer = document.getElementById('buttonGroup');
  const timerContainer = document.getElementById('timerContainer');
  const buttons = document.querySelectorAll('#buttonGroup button');

  let endTs = 0, remainingMs = 0, paused = false, rafId = null;

  function beep() {
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const o = ctx.createOscillator();
      const g = ctx.createGain();
      o.type = 'sine';
      o.connect(g); g.connect(ctx.destination);
      const now = ctx.currentTime;
      g.gain.setValueAtTime(0.0001, now);
      g.gain.exponentialRampToValueAtTime(0.2, now + 0.02);
      o.frequency.setValueAtTime(440, now);
      o.frequency.exponentialRampToValueAtTime(880, now + 0.35);
      o.start(now);
      o.stop(now + 0.5);
      o.onended = () => ctx.close();
    } catch {}
  }

  function format(ms) {
    ms = Math.max(0, ms);
    const totalSec = Math.floor(ms / 1000);
    const h = Math.floor(totalSec / 3600);
    const m = Math.floor((totalSec % 3600) / 60);
    const s = totalSec % 60;
    return h > 0 ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}` :
                   `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  function render() {
    if (paused) {
      timerEl.textContent = format(remainingMs);
      rafId = requestAnimationFrame(render);
      return;
    }
    const msLeft = endTs - performance.now();
    remainingMs = msLeft;
    timerEl.textContent = format(msLeft);
    if (msLeft <= 0) {
      stop(true);
      return;
    }
    rafId = requestAnimationFrame(render);
  }

  function start(minutes) {
    cancelAnimationFrame(rafId);
    endTs = performance.now() + minutes * 60000;
    remainingMs = minutes * 60000;
    paused = false;
    timerEl.classList.remove('flash');
    statusEl.textContent = `En cours (${minutes} min)…`;
    buttonsContainer.classList.add('hidden');
    timerContainer.style.display = 'block';
    pauseBtn.disabled = false;
    resetBtn.disabled = false;
    pauseBtn.textContent = 'Pause';
    rafId = requestAnimationFrame(render);
  }

  function stop(done=false) {
    cancelAnimationFrame(rafId);
    pauseBtn.disabled = true;
    resetBtn.disabled = true;
    if (done) {
      timerEl.textContent = 'Terminé';
      statusEl.textContent = 'Minuteur terminé.';
      timerEl.classList.add('flash');
      beep(); setTimeout(beep, 400); setTimeout(beep, 800);
    } else {
      timerEl.textContent = '00:00';
      statusEl.textContent = 'Réinitialisé.';
      timerEl.classList.remove('flash');
      timerContainer.style.display = 'none';
      buttonsContainer.classList.remove('hidden');
    }
  }

  function togglePause() {
    if (paused) {
      paused = false;
      endTs = performance.now() + remainingMs;
      pauseBtn.textContent = 'Pause';
      statusEl.textContent = 'Reprise…';
    } else {
      paused = true;
      remainingMs = Math.max(0, endTs - performance.now());
      pauseBtn.textContent = 'Reprendre';
      statusEl.textContent = 'En pause.';
    }
  }

  // Event listeners
  buttons.forEach(btn =>
    btn.addEventListener('click', () => start(parseInt(btn.dataset.minutes)))
  );
  pauseBtn.addEventListener('click', togglePause);
  resetBtn.addEventListener('click', () => stop(false));
  fsBtn.addEventListener('click', () => {
    const el = document.documentElement;
    if (!document.fullscreenElement) el.requestFullscreen();
    else document.exitFullscreen();
  });
})();
</script>
</body>
</html>
